\begin{figure}[h]
\begin{tikzpicture}


\tikzset{
     element/.style={
     	rounded corners,
     	rectangle,
  	 	thick,
  	 	draw=black,
  	 	minimum height=2.5cm,minimum width=2.5cm
     }
}

\tikzset{
	elementtitle/.style={
		rectangle,
		rounded corners,
		fill=gray!80,
		font=\footnotesize,
		text=white,
		anchor=north
	}
}

\def\convCmPt{0.0352778}
\def\convCmPtRec{0.019844}
\def\convCmPtRecThird{0.0066147}
\def\convCmPtFourth{0.0088194}


\tikzset{
	spherical/.pic={
		\draw (-0.0352778*#1,0) arc (180:360:#1 pt and 0.5*#1 pt);
	    \draw[densely dashed] (-0.0352778*#1,0) arc (180:0:#1 pt and 0.5*#1 pt);
   	    \draw (0,0.0352778*#1) arc (90:270:0.5*#1 pt and #1 pt);
   	    \draw[densely dashed] (0,0.0352778*#1) arc (90:-90:0.5*#1 pt and #1 pt);
     	\draw (0,0) circle (#1 pt);
     	\shade[ball color=blue!10!white,opacity=0.20] (0,0) circle (#1 pt);
    }
}

\tikzset{
	pics/equirectangular/.style n args={3}{
		code={
			\draw[fill=gray!30] (-0.0352778*#1, -0.019844*#1) rectangle (0.0352778*#1, 0.019844*#1);
			\draw[draw=none,fill=gray!70] (0.0088194*#2*#1-2*0.0088194*#1, 0.0066147*#3*#1 - 2*0.0066147*#1) rectangle (0.0088194*#2*#1 + 2*0.0088194*#1, 0.0066147*#3*#1 + 2*0.0066147*#1);
			\draw[draw,fill=none] (-0.0352778*#1, -0.019844*#1) rectangle (0.0352778*#1, 0.019844*#1);
			\draw[color=black,fill=black] (0.0088194*#2*#1, 0.0066147*#3*#1) circle (1pt);
		}		
	}
}

\tikzset{cross/.style={cross out, draw, 
         minimum size=2*(#1-\pgflinewidth), 
         inner sep=0pt, outer sep=0pt}}

\tikzset{
	fov/.pic ={
		\draw[densely dotted, thick, red] (0,0.15) rectangle (0.4,-0.25);
%		\draw[fill=red] (0.2,-0.05) circle (2pt);
		\draw (0.2,-0.05) node[cross=2pt,red] {};
	}
} 

\tikzset{
	vr/.pic = {
		\draw[rounded corners] (-0.0352778*#1, -0.019844*#1) rectangle (0.0352778*#1, 0.019844*#1);
		\draw[rounded corners, thick] (-0.032*#1, -0.019844*#1) rectangle (0.032*#1, 0.016*#1);
%		\draw(-0.019*#1,0) pic {fov};
%		\draw(0.019*#1,0) pic {fov};
		\node[font=\scriptsize,rectangle,red, draw=red, thick,
					densely dotted, anchor=east, inner sep=2pt,
					yshift=-1pt, xshift=-1pt] at (0,0) {L};
		\node[font=\scriptsize,rectangle,red, draw=red, thick,
					densely dotted, anchor=west, inner sep=2pt,
					yshift=-1pt,xshift=0.5pt] at (0,0) {R};
	}
}
		
\def\ecartElement{20pt}
\def\sizeSphere{13}
\def\ecartObjet{2}
\def\ecartYVersions{20pt}


% capturing system
\node[element] (0,0) (capturing) {};
\node[elementtitle, above=-5pt of capturing] {capturing};
\draw ([xshift=-\sizeSphere - \ecartObjet pt]capturing.east) pic {spherical=\sizeSphere};
\pgfdeclareimage[width=18 pt]{camera}{video-camera-icon-hi.png}
\node at ([xshift=21 pt]capturing.west) (camera1)
    {\pgfbox[right,center]{\pgfuseimage{camera}}};
    
% the arrow in the capture
\draw[-latex] (camera1.east) to ([xshift=-2*\sizeSphere - 2*\ecartObjet pt]capturing.east);


% ===== server
\node[element,right=\ecartElement of capturing] (server) {};
\node[elementtitle, above=-5pt of server] {\vphantom{pt}server};
\draw ([xshift=\sizeSphere + \ecartObjet pt]server.west) pic {spherical=\sizeSphere};
\draw ([xshift=-\sizeSphere - \ecartObjet pt]server.east) pic {equirectangular={\sizeSphere}{2}{1}};
\draw ([xshift=-\sizeSphere - \ecartObjet pt, yshift=\ecartYVersions]server.east) pic {equirectangular={\sizeSphere}{-2}{-1}};
\draw ([xshift=-\sizeSphere - \ecartObjet pt, yshift=-\ecartYVersions]server.east) pic {equirectangular={\sizeSphere}{0}{0}};

% the three arrows in the server
\draw[-latex] ([xshift=2*\sizeSphere + 2*\ecartObjet pt]server.west) to ([xshift=-2*\sizeSphere - 2*\ecartObjet pt]server.east);
\draw[-latex] ([xshift=2*\sizeSphere + 2*\ecartObjet pt]server.west) to ([xshift=-2*\sizeSphere - 2*\ecartObjet pt, yshift=\ecartYVersions]server.east);
\draw[-latex] ([xshift=2*\sizeSphere + 2*\ecartObjet pt]server.west) to ([xshift=-2*\sizeSphere - 2*\ecartObjet pt, yshift=-\ecartYVersions]server.east);

% between capture and server
\draw[-latex] ([xshift=2pt]capturing.east) to ([xshift=-2pt]server.west);


% ===== client
\node[element,right=\ecartElement of server] (client) {};
\node[elementtitle, above=-5pt of client] {\vphantom{pt}client};
% the equirecntagular
\draw([xshift=\sizeSphere + \ecartObjet pt, yshift=-\ecartYVersions]client.west) pic {equirectangular={\sizeSphere}{0}{0}};
% the old vr
%\draw ([xshift=-\sizeSphere - \ecartObjet pt]client.east) pic {vr=\sizeSphere};
% the fov
\draw([xshift=\sizeSphere + \ecartObjet pt, yshift=-\ecartYVersions]client.west) pic {fov};

% vr headset
\pgfdeclareimage[width=24 pt]{vrheadset}{vr_icon.png}
\node at ([xshift=-28 pt]client.east) (headset)
    {\pgfbox[left,center]{\pgfuseimage{vrheadset}}};
    
% old vr    
%

% the arrow in the client
\draw[-latex] ([xshift=2*\sizeSphere + 2*\ecartObjet pt,
						yshift=-\ecartYVersions]client.west) to 
						([xshift=-2*\sizeSphere - 2*\ecartObjet pt]client.east);


% between server and client
\draw[-latex] ([xshift=2pt, yshift=-\ecartYVersions]server.east) to ([xshift=-2pt, yshift=-\ecartYVersions]client.west);


\end{tikzpicture}
\caption{Navigable 360-degree video delivery system. The server
offers video versions for three \acp{QEC}, the dark grey being the high quality and the light
gray the low quality. The \ac{FoV} of the client is the dotted red rectangle centered on the 
cross}
\label{fig:deliverychain}
\end{figure}
